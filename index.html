<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light only">
    <meta name="supported-color-schemes" content="light">
    <title>Smart Doorlock Capstone</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="indexstyle.css?v=3.0">

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=75f5ad508e0e54ef29a0f0dc6e89ef5a&autoload=false"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        /* 최소한의 인라인 스타일: indexstyle.css가 없을 때 기본 레이아웃 유지용 */
        body { font-family: 'Poppins', sans-serif; margin:0; padding:0; background:#f7f9fc; color:#222; }
        #login-container { max-width:360px; margin:80px auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
        #login-container h2 { margin:0 0 12px 0; text-align:center; }
        .input-group { margin-bottom:12px; }
        .input-group label { display:block; margin-bottom:6px; font-size:14px; color:#444; }
        .input-group input { width:100%; padding:10px; border-radius:8px; border:1px solid #e0e0e0; }
        button { cursor:pointer; }
        #header { display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
        #header h1 { margin:0; font-size:18px; }
        .button-group button { margin-left:8px; padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; }
        .hidden { display:none; }
        #main-content { display:flex; gap:16px; padding:16px; }
        #sidebar { width:320px; background:#fff; padding:12px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
        #mapArea { flex:1; background:#fff; padding:12px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
        #map { width:100%; height:600px; border-radius:8px; }
        .user { padding:8px 10px; border-radius:8px; margin-bottom:8px; background:#f8f9fb; cursor:pointer; }
        .log-card { margin-bottom:10px; }
        .log-tab-btn.active { background:#007bff; color:#fff; border-color:#007bff; }
        .log-section { padding:12px; }
        .active-tab-content { display:block; }
        .log-section { display:none; }
        .filter-btn.active { background:#007bff; color:#fff; border-color:#007bff; }
        .fv-key { cursor:pointer; color:#0b5ed7; }
        .fv-children { margin-left:6px; }
        .fv-hidden { display:none; }
        .grid-wrapper { overflow:auto; max-height:520px; }
        table.styled-table { width:100%; border-collapse:collapse; }
        table.styled-table th, table.styled-table td { padding:8px; border-bottom:1px solid #eee; text-align:left; vertical-align:top; }
    </style>
</head>
<body>

    <div id="login-container">
        <h2>SmartDoorLock</h2>
        <form id="login-form">
            <div class="input-group">
                <label for="username">아이디</label>
                <input type="text" id="username" placeholder="아이디를 입력하세요" required>
            </div>
            <div class="input-group">
                <label for="password">비밀번호</label>
                <input type="password" id="password" placeholder="비밀번호를 입력하세요" required>
            </div>
            <button type="submit">로그인</button>
        </form>
    </div>

    <div id="header" class="hidden">
        <h1 id="header-title">Smart Doorlock</h1> 
        <div class="button-group">
            <button id="mapBtn" disabled>지도</button>
            <button id="logBtn" disabled>로그 보기</button>
            <button id="newBtn">DB 조회</button>
            <button id="logoutBtn">로그아웃</button>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <div id="sidebar">
            <div id="userInfo" class="hidden">
                <div class="info-header" style="display:flex; justify-content:space-between; align-items:center;">
                    <h2>User Info</h2>
                    <button id="closeUserInfoBtn" title="닫기">✕</button>
                </div>
                <div id="infoArea">사용자를 선택해주세요.</div>
            </div>
            <div id="userList">
                <h2>User List</h2>
            </div>
        </div>
        <div id="mapArea">
            <h2>Map</h2>
            <div id="map"></div> 
        </div>
    </div>

    <div id="log-content" class="hidden">
        <div class="log-header" style="padding:12px; background:#fff; border-bottom:1px solid #eee;">
            <h2 id="logUserTitle">전체 로그</h2>
        </div>
        <div class="log-tab-buttons" style="padding:12px; background:#fff;">
            <button id="tab-doorlock" class="log-tab-btn active" onclick="switchLogTab('doorlock')">도어락 로그</button>
            <button id="tab-app" class="log-tab-btn" onclick="switchLogTab('app')">앱 로그</button>
        </div>
        <div class="log-container" style="padding:12px;">
            <div id="doorLockLogs" class="log-section active-tab-content">
                <div class="log-entries"></div>
            </div>
            <div id="appLogs" class="log-section">
                <div class="log-entries"></div>
            </div>
        </div>
    </div>

    <div id="db-content" class="hidden">
        <div class="container" style="padding:16px;">
            <h2>DataBase</h2>
            <div class="search-container" style="display:flex; gap:8px; margin-bottom:12px;">
                <input type="text" id="search-input" placeholder="검색할 사용자 ID 입력" style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;">
                <button class="btn-search" onclick="searchUser()">검색</button>
                <button class="btn-reset" onclick="loadAllDBData()">전체 목록</button>
            </div>
            <h3 id="result-title">User List:</h3>
            <div id="result-area">
                <div style="padding:20px; text-align:center; color:#666;">데이터를 불러오는 중...</div>
            </div>
        </div>
    </div>

    <div id="custom-modal" class="hidden" style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4);">
        <div class="modal-content" style="background:#fff; padding:20px; border-radius:12px; min-width:260px; text-align:center;">
            <p id="modal-message"></p>
            <button onclick="document.getElementById('custom-modal').style.display='none';" style="margin-top:12px;">확인</button>
        </div>
    </div>

    <div id="logout-confirm-modal" class="hidden" style="position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4);">
        <div class="modal-content" style="background:#fff; padding:20px; border-radius:12px; min-width:300px; text-align:center;">
            <p>로그아웃 하시겠습니까?</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="confirmLogoutBtn" style="flex: 1;">확인</button>
