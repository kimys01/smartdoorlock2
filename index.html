<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íŠ¹ì • ìœ ì € ìœ„ì¹˜ í‘œì‹œ</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=0c43dda5249fa5372cb6f65f0320a50f&autoload=false"></script>
  <style>
    #map { width: 100%; height: 400px; }
  </style>
</head>
<body>
  <h1>ìœ ì € 12345678 ìœ„ì¹˜ ê¸°ë¡</h1>
  <div id="map"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDr3DxG99ZNyW16Ui0SHCFHRNNC0NkpA_U",
      authDomain: "smartdoorlock-b4636.firebaseapp.com",
      databaseURL: "https://smartdoorlock-b4636-default-rtdb.firebaseio.com",
      projectId: "smartdoorlock-b4636",
      storageBucket: "smartdoorlock-b4636.appspot.com", <!-- ğŸ”§ ìˆ˜ì •ë¨ -->
      messagingSenderId: "104489505270",
      appId: "1:104489505270:web:0d663b2ae774b77a2077d7",
      measurementId: "G-YL6TMYN453"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    let map;
    let markers = [];

    function initMap() {
      map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 7
      });
    }

    function clearMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];
    }

    function showLocations(locations) {
      clearMarkers();

      if (!locations) return;

      Object.values(locations).forEach(loc => {
        if (!loc.latitude || !loc.longitude) return;
        const position = new kakao.maps.LatLng(loc.latitude, loc.longitude);
        const marker = new kakao.maps.Marker({
          position: position,
          map: map
        });
        markers.push(marker);
      });

      if (markers.length > 0) {
        map.setCenter(markers[0].getPosition());
        map.setLevel(5);
      }
    }

    kakao.maps.load(() => {
      initMap();

      const userId = "12345678";  // âœ… ì‚¬ìš©ì ID ìˆ˜ì •ë¨

      const userLocationsRef = ref(database, `location_logs/${userId}`);

      onValue(userLocationsRef, (snapshot) => {
        const locations = snapshot.val();
        console.log("ì½ì€ ìœ„ì¹˜ ë°ì´í„°:", locations);
        showLocations(locations);
      }, (error) => {
        console.error("Firebase ì½ê¸° ì˜¤ë¥˜:", error);
      });
    });
  </script>
</body>
</html>